<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Ion cel mai TOP ‚Äî Pixel Galaxy</title>
<style>
  :root{
    --c1:#00ffff; --c2:#ff66cc; --c3:#ffcc00; --c4:#00ff66;
    --panel:#13141a; --panel-border:#2ee7ff; --text:#f8f8ff;
    --ok:#00ffa6; --warn:#ffcc00; --bad:#ff4d6d;
    --px: 0px; --py: 0px; --tilt: 0deg;
  }

  html,body{
    margin:0; padding:0; height:100vh; width:100vw; overflow:hidden;
    background:
      radial-gradient(circle at 30% 20%, #0b1c3d 0%, #090f2c 42%, #060713 72%, #04040a 100%),
      #04040a;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Courier New", monospace;
    color:var(--text);
    -webkit-tap-highlight-color: transparent;
  }

  /* Layers */
  .bg-gradient{ position:fixed; inset:0; z-index:-6;
    background:
      radial-gradient(1200px 800px at 10% 110%, rgba(0,255,255,.10), transparent 60%),
      radial-gradient(900px 600px at 90% -10%, rgba(255,102,204,.08), transparent 55%),
      radial-gradient(700px 500px at 50% 50%, rgba(255,204,0,.06), transparent 60%),
      linear-gradient(120deg, #050509, #0a0b12 60%, #050509);
    animation:hue 50s linear infinite; will-change:filter; }
  @keyframes hue{from{filter:hue-rotate(0deg)}to{filter:hue-rotate(360deg)}}

  .nebula{ position:fixed; inset:0; z-index:-5; pointer-events:none; mix-blend-mode:screen;
    transform: translate(var(--px), var(--py)) rotate(var(--tilt)); transition: transform .12s ease-out;
    background:
      radial-gradient(900px 700px at 20% 40%, rgba(124,58,237,.10), transparent 60%),
      radial-gradient(1100px 800px at 80% 55%, rgba(14,165,233,.08), transparent 65%),
      radial-gradient(1400px 900px at 50% 120%, rgba(255,105,180,.06), transparent 70%);
    filter: saturate(120%) blur(.2px); animation:nebulaDrift 90s ease-in-out infinite;
  }
  @keyframes nebulaDrift{
    0%{ transform: translate(var(--px), var(--py)) rotate(0) }
    50%{ transform: translate(calc(var(--px)*1.4), calc(var(--py)*1.4)) rotate(1deg) }
    100%{ transform: translate(var(--px), var(--py)) rotate(0) }
  }

  .aurora{ position:fixed; inset:-10% -10%; z-index:-4; pointer-events:none;
    background:
      conic-gradient(from 0deg at 20% 20%, rgba(0,255,153,.07), transparent 35%),
      conic-gradient(from 180deg at 80% 60%, rgba(0,204,255,.06), transparent 40%),
      conic-gradient(from 300deg at 50% 100%, rgba(255,102,204,.05), transparent 30%);
    filter: blur(18px) saturate(120%); animation: auroraFlow 30s linear infinite; mix-blend-mode: screen; }
  @keyframes auroraFlow{from{transform:rotate(0) scale(1)}50%{transform:rotate(3deg) scale(1.03)}to{transform:rotate(0) scale(1)}}

  .orbs{ position:fixed; inset:0; z-index:-3; pointer-events:none; filter: blur(20px) saturate(120%); }
  .orb{ position:absolute; width:240px; height:240px; border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.8), rgba(255,255,255,0) 60%),
                radial-gradient(circle at 70% 70%, currentColor, rgba(0,0,0,0) 70%);
    opacity:.12; animation:drift 40s linear infinite; }
  .o1{ color:var(--c1); top:70%; left:5%; animation-duration:48s}
  .o2{ color:var(--c2); top:20%; left:75%; animation-duration:42s}
  .o3{ color:var(--c4); top:50%; left:40%; animation-duration:55s}
  @keyframes drift{0%{transform:translate(0,0) rotate(0) scale(1)}
                   50%{transform:translate(120px,-80px) rotate(180deg) scale(1.15)}
                   100%{transform:translate(0,0) rotate(360deg) scale(1)}}

  .stars,.stars2{ position:fixed; inset:0; z-index:-2; overflow:hidden; pointer-events:none; }
  .stars span,.stars2 span{ position:absolute; border-radius:50%; opacity:.9;
    filter: drop-shadow(0 0 6px currentColor);
    animation: floatY var(--fy) linear infinite, twinkle var(--tw) ease-in-out infinite; }
  @keyframes floatY{ from{ transform: translateY(10vh)} to{ transform: translateY(-190vh)} }
  @keyframes twinkle{ 0%,100%{ opacity:.25; transform: scale(.7)} 50%{opacity:1; transform: scale(1.2)} }

  .noise{ position:fixed; inset:-2% -2%; z-index:-1; pointer-events:none; opacity:.08; mix-blend-mode: soft-light;
    background:
      repeating-radial-gradient(circle at 10% 20%, rgba(255,255,255,.03) 0 1px, transparent 1px 3px),
      repeating-linear-gradient(0deg, rgba(0,0,0,.06) 0 2px, transparent 2px 4px),
      repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 3px);
    animation: noisePulse 6s ease-in-out infinite; }
  @keyframes noisePulse{0%,100%{opacity:.06}50%{opacity:.10}}

  .scanlines{ position:fixed; inset:0; z-index:10; pointer-events:none;
    background:
      radial-gradient(ellipse at 50% 50%, rgba(0,0,0,0) 60%, rgba(0,0,0,.45) 100%),
      repeating-linear-gradient(to bottom, rgba(255,255,255,.04) 0 2px, transparent 2px 4px);
    mix-blend-mode: screen; }

  /* Bouncing title (screensaver) */
  .center-text{
    position:absolute; left:16px; top:16px; z-index:3;
    font-weight:900; line-height:1.05;
    font-size: clamp(1.8rem, 8vw, 4rem);
    letter-spacing:.5px;
    /* Make ONLY text gradient-free if needed: comment next 3 lines to remove gradient entirely */
    background:linear-gradient(270deg,var(--c2),var(--c1),var(--c3),var(--c4),var(--c2));
    background-size:600% 600%;
    -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
    text-shadow:0 0 10px rgba(255,255,255,.18);
    animation:gradientFlow 12s ease infinite;
    user-select:none; -webkit-user-select:none; touch-action:manipulation;
  }
  @keyframes gradientFlow{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}

  /* Panels & controls */
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    backdrop-filter: blur(8px);
    border:3px solid var(--panel-border);
    box-shadow:0 0 0 6px rgba(139,92,246,.22), inset 0 0 0 2px rgba(255,255,255,.06),
               0 14px 34px rgba(0,0,0,.55), 0 0 18px rgba(46,231,255,.22);
    border-radius:14px;
  }
  .pixel-border{ position:relative; }
  .pixel-border:before{ content:""; position:absolute; inset:-6px; border:2px solid rgba(255,255,255,.15);
    filter:drop-shadow(0 0 6px rgba(46,231,255,.4)); border-radius:8px; pointer-events:none; }

  .btn{
    background:linear-gradient(45deg,#ff66cc,#ffcc00); color:#0b0b13; font-weight:800; border:none;
    padding:12px 16px; border-radius:12px; cursor:pointer;
    box-shadow:0 4px 0 #000, 0 0 12px rgba(255,102,204,.6);
    transition:transform .08s ease, filter .2s ease;
    font-size:16px;
  }
  .btn:active{ transform:translateY(2px) }

  .modal{ position:fixed; inset:0; display:none; z-index:6; justify-content:center; align-items:center; background:rgba(0,0,0,.6); padding:env(safe-area-inset-top) 12px env(safe-area-inset-bottom); }
  .modal .content{ width:min(760px,92vw); padding:18px; text-align:center; }

  .hud{ position:fixed; top:10px; left:10px; z-index:5; padding:10px 12px; font-weight:800; letter-spacing:.5px; }
  .hud small{opacity:.8}

  .game{ position:fixed; inset:0; display:none; z-index:7; justify-content:center; align-items:center; gap:12px; background:rgba(0,0,0,.55); padding:24px; }
  .stage{ position:relative; width:min(900px, 92vw); height:min(60vh, 520px); max-height:70vh; overflow:hidden; padding:12px; }

  #gameCat,#gameDog{ position:absolute; text-align:center; user-select:none; cursor:pointer; transform:translate(-50%,-50%);
    filter:drop-shadow(0 4px 10px rgba(0,0,0,.6)) drop-shadow(0 0 16px rgba(255,255,255,.3)); }
  #gameCat{ --size:84px; width:var(--size); height:var(--size); line-height:var(--size); font-size:calc(var(--size)*.66); }
  #gameDog{ width:72px; height:72px; line-height:72px; font-size:52px; opacity:.95; }

  .meter{height:12px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.25); border-radius:999px; overflow:hidden;}
  .meter>span{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--ok),var(--warn),var(--bad)); transition:width .3s ease;}

  .toast{ position:fixed; bottom:16px; left:50%; transform:translateX(-50%); z-index:9;
    padding:10px 14px; border-radius:12px; color:#0b0b13; background:#fefefe;
    border:2px solid var(--panel-border); box-shadow:0 10px 30px rgba(0,0,0,.45);
    font-weight:800; display:none; max-width:min(92vw,680px); text-align:center; }

  .ripple{ position:fixed; width:12px; height:12px; border-radius:50%; border:2px solid rgba(255,255,255,.45);
           pointer-events:none; z-index:2; transform:translate(-50%,-50%); animation:ripple .6s ease-out forwards; }
  @keyframes ripple{ from{opacity:.8; transform:translate(-50%,-50%) scale(.4)} to{opacity:0; transform:translate(-50%,-50%) scale(8)} }
  .spark{ position:fixed; width:8px; height:8px; border-radius:2px; pointer-events:none; background:currentColor; z-index:4; animation:pop .65s ease-out forwards; }
  @keyframes pop{0%{opacity:1; transform:translate(0,0) scale(1)}100%{opacity:0; transform:translate(var(--dx),var(--dy)) scale(.2)}}

  /* Mobile tweaks */
  @media (max-width: 480px){
    .btn{ padding:14px 16px; font-size:17px; }
    .hud{ font-size:14px; }
    #gameCat{ --size:72px; }
  }
</style>
</head>
<body>

  <!-- BACKGROUND LAYERS -->
  <div class="bg-gradient"></div>
  <div class="nebula"></div>
  <div class="aurora"></div>
  <div class="orbs"><div class="orb o1"></div><div class="orb o2"></div><div class="orb o3"></div></div>
  <div class="stars" id="stars"></div>
  <div class="stars2" id="stars2"></div>
  <div class="noise"></div>

  <!-- TITLE (screensaver bounce). NOTE: no emoji, only text as requested -->
  <div class="center-text" id="title" tabindex="0" aria-label="Deschide meniul principal">Ion cel mai TOP</div>

  <!-- HUD -->
  <div class="hud panel pixel-border" id="hud" style="display:none;">
    <div><span>üê± Scor:</span> <span id="score">0</span></div>
    <div><small>‚ö° VitezƒÉ:</small> <span id="speedLabel">1.0x</span></div>
    <div><small>üß≠ Nivel:</small> <span id="levelLabel">1</span></div>
    <div><small>‚è≥ Timp:</small> <span id="timeLabel">30.0s</span></div>
  </div>

  <!-- MAIN MODAL -->
  <div class="modal" id="modal1" role="dialog" aria-modal="true">
    <div class="content panel pixel-border">
      <h2 style="margin:8px 0 6px">Ion cel mai TOP</h2>
      <p style="margin:0 0 14px; opacity:.85">Mod petrecere galacticƒÉ. Alege distrac»õia »ôi fƒÉ-l pe Ion sƒÉ z√¢mbeascƒÉ.</p>

      <div style="margin:10px auto 18px; display:flex; flex-direction:column; align-items:center; gap:10px;">
        <div style="font-size:1.1rem; font-weight:900; letter-spacing:.4px;">Eu sunt Ion, cel mai tare dansator</div>
        <img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExNnRzM25yZjl6cWVzOTRqNmd5aWJzcjVweGR0N3Nwem1jendzaGI1dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/BK1EfIsdkKZMY/giphy.gif"
             alt="Ion danseazƒÉ" style="max-width:100%; width:340px; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,.5); outline:3px solid var(--panel-border);"/>
      </div>

      <!-- Meter -->
      <div style="margin:8px 0 6px; font-weight:800;">üìà Ion-o-metru</div>
      <div class="meter"><span id="meterFill"></span></div>

      <!-- Jokes (static + random) -->
      <div class="panel pixel-border" style="margin:14px auto 8px; padding:12px; max-width:640px;">
        <div style="font-weight:800; margin-bottom:6px;">GlumƒÉ de √ÆncƒÉlzire</div>
        <div id="glumaText" style="opacity:.95;">Se spune cƒÉ stelele clipesc c√¢nd danseazƒÉ Ion. ConfirmƒÉm. üåü</div>
        <div style="margin-top:10px; display:flex; gap:10px; justify-content:center;">
          <button class="btn" onclick="schimbaGluma()">AltƒÉ glumƒÉ üîÅ</button>
        </div>
      </div>

      <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:12px;">
        <button class="btn" onclick="openGame()">JoacƒÉ ‚ÄòPrinde Pisica‚Äô üê±</button>
        <button class="btn" onclick="shuffleTheme()">SchimbƒÉ culorile</button>
        <button class="btn" onclick="spuneCompliment()">Compliment pentru Ion üíñ</button>
        <button class="btn" onclick="openModal('modalHam')">Nu atinge»õi üò≠</button>
        <button class="btn" onclick="closeModal('modal1')">√énchide</button>
      </div>
    </div>
  </div>

  <!-- SECOND MODAL: sad hamster -->
  <div class="modal" id="modalHam" role="dialog" aria-modal="true">
    <div class="content panel pixel-border">
      <h3 style="margin:8px 0 10px;">Nu atinge»õi‚Ä¶ ups! üêπüíß</h3>
      <p style="margin:0 0 12px; opacity:.9;">Acuma Ion √Æi supƒÉrat »ôi pl√¢nge. DƒÉ-i un compliment ca sƒÉ-i treacƒÉ! üò≠</p>
      <img src="https://media1.tenor.com/m/oSKKipnYg5MAAAAd/hamsti-hamster.gif" alt="Hamster pl√¢ngƒÉcios"
           style="max-width:100%; width:320px; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,.5); outline:3px solid var(--panel-border);" />
      <div style="margin-top:14px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
        <button class="btn" onclick="spuneCompliment()">Trimite un compliment üíå</button>
        <button class="btn" onclick="closeModal('modalHam')">√émi pare rƒÉu, √Ænchid</button>
      </div>
      <p style="margin-top:10px; opacity:.7; font-size:.9rem;">Tip: apasƒÉ √Æn afara ferestrei ca sƒÉ √Ænchizi.</p>
    </div>
  </div>

  <!-- GAME -->
  <div class="game" id="game" aria-live="polite">
    <div class="content panel pixel-border" style="text-align:center;">
      <h2 style="margin:6px 0 14px">Prinde Pisica üê± (+ C√¢ine »ôiret üê∂)</h2>
      <div class="stage panel pixel-border" id="stage" aria-label="Arena de joc">
        <div id="gameCat" title="Prinde-mƒÉ!">üê±</div>
        <div id="gameDog" title="Nu da click pe mine!" style="display:none;">üê∂</div>
      </div>
      <div style="margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
        <button class="btn" onclick="resetGame()">Restart</button>
        <button class="btn" onclick="exitGame()">Ie»ôire</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>
  <div class="scanlines"></div>

<script>
/* ===== Utils ===== */
const rand=(a,b)=>Math.random()*(b-a)+a;
const pick=a=>a[(Math.random()*a.length)|0];
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const palette=["#00ffff","#ff66cc","#ffcc00","#00ff66","#ffffff"];

/* Parallax */
addEventListener('mousemove',e=>{
  const x=(e.clientX/innerWidth-.5), y=(e.clientY/innerHeight-.5);
  document.documentElement.style.setProperty('--px',(x*16).toFixed(1)+'px');
  document.documentElement.style.setProperty('--py',(y*12).toFixed(1)+'px');
  document.documentElement.style.setProperty('--tilt',(x*y*2).toFixed(2)+'deg');
},{passive:true});

/* Stars (pointer-events:none for mobile so title is clickable) */
function spawnStars(container,count,sMin,sMax,spMin,spMax){
  for(let i=0;i<count;i++){
    const s=document.createElement('span'), size=rand(sMin,sMax);
    s.style.width=s.style.height=size+"px";
    s.style.left=rand(0,100)+"%"; s.style.top=rand(0,100)+"%";
    s.style.color=pick(palette);
    s.style.setProperty('--fy', rand(spMin,spMax)+"s");
    s.style.setProperty('--tw', rand(2,4.5)+"s");
    s.style.animationDelay=(rand(-20,20))+"s, "+(rand(0,3))+"s";
    container.appendChild(s);
  }
}
spawnStars(document.getElementById('stars'),120,2,4.2,12,26);
spawnStars(document.getElementById('stars2'),70,3.2,5.5,18,36);

/* Shooting stars */
function shootingStar(){
  const el=document.createElement('div');
  el.style.position='fixed'; el.style.zIndex='-2'; el.style.pointerEvents='none';
  const startX=rand(0, innerWidth*0.8), startY=rand(-40, innerHeight*0.3);
  const len=rand(110,220);
  el.style.left=startX+'px'; el.style.top=startY+'px';
  el.style.width=len+'px'; el.style.height='2px';
  el.style.background='linear-gradient(90deg, rgba(255,255,255,.9), transparent)';
  el.style.filter='drop-shadow(0 0 6px rgba(255,255,255,.8))';
  const rot = `rotate(${rand(15,35)}deg)`; el.style.transform=rot; el.style.opacity='0';
  document.body.appendChild(el);
  el.animate([{opacity:0, transform:rot+' translate(0,0)'},{opacity:1, transform:rot+' translate(80px,60px)'},{opacity:0, transform:rot+' translate(160px,120px)'}],{duration:1200,easing:'ease-out'});
  setTimeout(()=>el.remove(),1300);
}
setInterval(()=>{ if(Math.random()<0.3) shootingStar(); },2200);

/* Screensaver-style bouncing title with mobile click */
const title=document.getElementById('title');
let vx=2.0, vy=1.6;
let tx=16, ty=16;

function measure(){ return {w:title.offsetWidth, h:title.offsetHeight}; }
function stepBounce(){
  const {w,h}=measure(), W=innerWidth, H=innerHeight;
  if(tx+w>=W-8 || tx<=8) vx*=-1;
  if(ty+h>=H-8 || ty<=8) vy*=-1;
  tx+=vx; ty+=vy;
  title.style.left=tx+"px"; title.style.top=ty+"px";
  requestAnimationFrame(stepBounce);
}
addEventListener('resize', ()=>{ const {w,h}=measure(); tx=Math.min(Math.max(8,tx), innerWidth-w-8); ty=Math.min(Math.max(8,ty), innerHeight-h-8); });

/* Make it easy to open on mobile (tap anywhere on text) */
const openMain=()=> openModal('modal1');
title.addEventListener('click', openMain);
title.addEventListener('touchstart', (e)=>{ e.preventDefault(); openMain(); }, {passive:false});

/* Start bouncing */
requestAnimationFrame(stepBounce);

/* FX helpers */
function burst(x,y,color=pick(palette)){
  for(let i=0;i<16;i++){
    const sp=document.createElement('div'); sp.className='spark'; sp.style.left=x+"px"; sp.style.top=y+"px"; sp.style.color=color;
    const ang=Math.random()*Math.PI*2, dist=rand(36,120);
    sp.style.setProperty('--dx',Math.cos(ang)*dist+"px"); sp.style.setProperty('--dy',Math.sin(ang)*dist+"px");
    document.body.appendChild(sp); setTimeout(()=>sp.remove(),680);
  }
}
function ripple(x,y){ const r=document.createElement('div'); r.className='ripple'; r.style.left=x+"px"; r.style.top=y+"px"; document.body.appendChild(r); setTimeout(()=>r.remove(),620); }
addEventListener('click',(e)=>{ if(e.target===document.body) burst(e.clientX,e.clientY, pick(palette)); });

/* Theme + modals */
function shuffleTheme(){
  const root=document.documentElement, cols=[...palette]; cols.push(cols.shift());
  root.style.setProperty('--c1',pick(cols)); root.style.setProperty('--c2',pick(cols)); root.style.setProperty('--c3',pick(cols)); root.style.setProperty('--c4',pick(cols));
  incMeter(3);
}
function openModal(id){ document.getElementById(id).style.display='flex'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }
addEventListener('click', e=>{ if(e.target.classList.contains('modal')) closeModal(e.target.id); });

/* Meter + jokes/compliments */
const meterFill=document.getElementById('meterFill');
const toast=document.getElementById('toast');
let meter=0;
function incMeter(v=1){ meter=clamp(meter+v,0,100); meterFill.style.width=meter+'%'; }
const glume=[
  "Ceasul nu-l √ÆntreabƒÉ pe Ion c√¢t e ora ‚Äî √Æl √ÆntreabƒÉ ‚Äòc√¢t de repede vrei sƒÉ fie?‚Äô.",
  "C√¢nd intrƒÉ Ion √Æn birou, »ôi Wi-Fi-ul stƒÉ drep»õi.",
  "Ion n-a pierdut niciodatƒÉ un tab ‚Äî doar le dƒÉ pauzƒÉ √Æn alt desktop.",
  "La cafea, Ion zice ‚Äòbuild & run‚Äô; cea»ôca executƒÉ.",
  "C√¢nd plouƒÉ, norii fac deploy. Ion le face rollback dacƒÉ nu-i pe plac.",
  "»òedin»õele cu Ion se optimizeazƒÉ singure la O(1) ‚Äî intri »ôi ie»ôi fericit.",
  "Bug-urile au un grup privat: ‚ÄòFeri»õi-vƒÉ de Ion‚Äô.",
  "Ion prinde o idee din aer »ôi-i face README.",
  "Shortcut-ul preferat al timpului? Ion+Enter."
];
const complimente=[
  "Ion, e»ôti upgrade-ul la starea noastrƒÉ de spirit. üî•",
  "C√¢nd e»ôti tu pe task, totul devine simplu »ôi elegant. üëè",
  "Ai superputerea de a face oamenii sƒÉ z√¢mbeascƒÉ. üòÑ",
  "Calm + creativ = tu. Ne iese totul mai bine cu tine √Æn echipƒÉ. üí™",
  "E»ôti genul de coleg pe care √Æl vrei mereu l√¢ngƒÉ tine. ü§ù",
  "Mul»õumim cƒÉ aduci vibe bun. Se simte imediat! ‚ú®"
];
function showToast(msg){
  toast.textContent=msg; toast.style.display='block';
  toast.animate([{transform:'translateX(-50%) translateY(20px)',opacity:0},{transform:'translateX(-50%) translateY(0)',opacity:1}],{duration:200,easing:'ease-out'});
  setTimeout(()=>{ toast.animate([{opacity:1},{opacity:0}],{duration:220,easing:'ease-in'}); setTimeout(()=>toast.style.display='none',210); },2000);
}
function spuneCompliment(){ showToast("üíñ " + pick(complimente)); incMeter(8); }
function schimbaGluma(){ document.getElementById('glumaText').textContent = pick(glume); incMeter(5); }
document.getElementById('glumaText').textContent = pick(glume);

/* ===== Game ===== */
const gameEl=document.getElementById('game');
const stage=document.getElementById('stage');
const cat=document.getElementById('gameCat');
const dog=document.getElementById('gameDog');
const hud=document.getElementById('hud');
const scoreEl=document.getElementById('score');
const speedEl=document.getElementById('speedLabel');
const levelEl=document.getElementById('levelLabel');
const timeEl=document.getElementById('timeLabel');

let score=0, level=1, target=10;
let timeLeft=30, size=84;
let interval=1200, speed=1;
let moveTimer=null, tickRAF=null;
const rafMap=new WeakMap();
let dogActive=false;

function openGame(){ closeModal('modal1'); closeModal('modalHam'); gameEl.style.display='flex'; hud.style.display='block'; resetGame(); }
function exitGame(){
  gameEl.style.display='none'; hud.style.display='none';
  clearTimeout(moveTimer); cancelAnimationFrame(tickRAF);
  const idC=rafMap.get(cat); if(idC) cancelAnimationFrame(idC);
  const idD=rafMap.get(dog); if(idD) cancelAnimationFrame(idD);
}
function resetGame(){
  score=0; level=1; target=10; timeLeft=30; size=84; interval=1200; speed=1;
  dogActive=false; dog.style.display='none';
  cat.style.setProperty('--size', size+'px');
  centerEl(cat); centerEl(dog);
  updateHUD(); clearTimeout(moveTimer); cancelAnimationFrame(tickRAF);
  scheduleMove(); startTimer();
}
function updateHUD(){ scoreEl.textContent=score; speedEl.textContent=speed.toFixed(1)+'x'; levelEl.textContent=level; timeEl.textContent=timeLeft.toFixed(1)+'s'; }

function scheduleMove(){
  clearTimeout(moveTimer);
  moveTimer=setTimeout(()=>{
    moveElSmooth(cat, interval);
    if(dogActive && Math.random()<0.8){ moveElSmooth(dog, interval*rand(0.85,1.35), rand(-60,60)); }
    scheduleMove();
  }, interval);
}
function centerEl(el){ const r=stage.getBoundingClientRect(); setElPos(el, r.width/2, r.height/2); }
function setElPos(el,x,y){ x=clamp(x,36,stage.clientWidth-36); y=clamp(y,36,stage.clientHeight-36); el.style.left=x+'px'; el.style.top=y+'px'; }
function moveElSmooth(el, intervalHint=interval, jitter=0){
  const start={x:parseFloat(el.style.left||"0"), y:parseFloat(el.style.top||"0")};
  let tx=rand(36,stage.clientWidth-36)+jitter, ty=rand(36,stage.clientHeight-36)+jitter;
  tx=clamp(tx,36,stage.clientWidth-36); ty=clamp(ty,36,stage.clientHeight-36);
  const duration=Math.max(200, Math.min(800, intervalHint*0.55));
  const t0=performance.now();
  function step(){
    const t=performance.now(); const p=Math.min(1,(t-t0)/duration);
    const e=p<0.5?2*p*p:-1+(4-2*p)*p;
    setElPos(el, start.x+(tx-start.x)*e, start.y+(ty-start.y)*e);
    if(p<1){ const id=requestAnimationFrame(step); rafMap.set(el,id); }
  }
  const id=requestAnimationFrame(step); rafMap.set(el,id);
}

cat.addEventListener('click',(e)=>{
  score++; incMeter(2);
  if(interval>260) interval=Math.max(260, interval-60);
  speed=1200/interval;
  if(score>=target){
    level++; target+=8+Math.floor(level*1.2); size=Math.max(60,size-6);
    cat.style.setProperty('--size', size+'px'); timeLeft+=4;
    showToast(`Nivel ${level} atins!`);
  }
  if(!dogActive){
    dogActive=true; dog.style.display='block'; centerEl(dog);
    moveElSmooth(dog, interval*1.1, rand(-40,40));
  }
  const rect=cat.getBoundingClientRect(); burst(rect.left+rect.width/2, rect.top+rect.height/2);
  moveElSmooth(cat, interval); scheduleMove(); updateHUD(); e.stopPropagation();
});

dog.addEventListener('click',(e)=>{
  const rect=dog.getBoundingClientRect(), cx=rect.left+rect.width/2, cy=rect.top+rect.height/2;
  score=Math.max(0, score-2); timeLeft=Math.max(0, timeLeft-2);
  showToast("üê∂ C√¢inele »õi-a furat 2 puncte »ôi 2 secunde!");
  burst(cx,cy,'#ff3355'); updateHUD(); e.stopPropagation();
});

function startTimer(){
  let last=performance.now();
  function tick(){
    const now=performance.now(); const dt=(now-last)/1000; last=now;
    timeLeft-=dt;
    if(timeLeft<=0){ showToast("Gata runda!"); exitGame(); return; }
    updateHUD(); tickRAF=requestAnimationFrame(tick);
  }
  tickRAF=requestAnimationFrame(tick);
}
stage.addEventListener('click',(e)=>{ const r=stage.getBoundingClientRect(); setElPos(cat, e.clientX-r.left, e.clientY-r.top); });

/* Initial joke */
document.getElementById('glumaText').textContent = pick(glume);
</script>
</body>
</html>
